{"code":"import { GraphQLUnionType, } from 'graphql';\r\nimport { resolveTypesList, isObjectType, resolveType } from '~/services/utils';\r\nimport { UnionError } from './error';\r\nconst compileUnionCache = new WeakMap();\r\nfunction getDefaultResolver(types) {\r\n    return (value, context, info) => {\r\n        for (let type of types) {\r\n            if (type.isTypeOf && type.isTypeOf(value, context, info)) {\r\n                return type;\r\n            }\r\n        }\r\n    };\r\n}\r\n/**\r\n * Resolves type, and if needed, tries to resolve it using typegql-aware types\r\n */\r\nfunction enhanceTypeResolver(originalResolver) {\r\n    return (value, context, info) => {\r\n        const rawResolvedType = originalResolver(value, context, info);\r\n        return resolveType(rawResolvedType);\r\n    };\r\n}\r\nfunction validateResolvedTypes(target, types) {\r\n    for (let type of types) {\r\n        if (!isObjectType(type)) {\r\n            throw new UnionError(target, `Every union type must be of type GraphQLObjectType. '${type}' is not.`);\r\n        }\r\n    }\r\n    return true;\r\n}\r\nexport function compileUnionType(target, config) {\r\n    if (compileUnionCache.has(target)) {\r\n        return compileUnionCache.get(target);\r\n    }\r\n    const { types, resolveTypes, name } = config;\r\n    const resolvedTypes = resolveTypesList(types);\r\n    if (!validateResolvedTypes(target, resolvedTypes)) {\r\n        return;\r\n    }\r\n    const typeResolver = resolveTypes\r\n        ? enhanceTypeResolver(resolveTypes)\r\n        : getDefaultResolver(resolvedTypes);\r\n    const compiled = new GraphQLUnionType({\r\n        name,\r\n        resolveType: typeResolver,\r\n        types: resolvedTypes,\r\n    });\r\n    compileUnionCache.set(target, compiled);\r\n    return compiled;\r\n}\r\n//# sourceMappingURL=compiler.js.map","map":"{\"version\":3,\"file\":\"compiler.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../src/domains/union/compiler.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EACL,gBAAgB,GAIjB,MAAM,SAAS,CAAC;AAEjB,OAAO,EAAE,gBAAgB,EAAE,YAAY,EAAE,WAAW,EAAE,MAAM,kBAAkB,CAAC;AAE/E,OAAO,EAAE,UAAU,EAAE,MAAM,SAAS,CAAC;AAYrC,MAAM,iBAAiB,GAAG,IAAI,OAAO,EAA8B,CAAC;AAEpE,SAAS,kBAAkB,CAAC,KAA0B;IACpD,OAAO,CAAC,KAAU,EAAE,OAAY,EAAE,IAAS,EAAE,EAAE;QAC7C,KAAK,IAAI,IAAI,IAAI,KAAK,EAAE;YACtB,IAAI,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,OAAO,EAAE,IAAI,CAAC,EAAE;gBACxD,OAAO,IAAI,CAAC;aACb;SACF;IACH,CAAC,CAAC;AACJ,CAAC;AAED;;GAEG;AACH,SAAS,mBAAmB,CAC1B,gBAAmC;IAEnC,OAAO,CAAC,KAAK,EAAE,OAAO,EAAE,IAAI,EAAE,EAAE;QAC9B,MAAM,eAAe,GAAG,gBAAgB,CAAC,KAAK,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC;QAC/D,OAAO,WAAW,CAAC,eAAe,CAAC,CAAC;IACtC,CAAC,CAAC;AACJ,CAAC;AAED,SAAS,qBAAqB,CAC5B,MAAgB,EAChB,KAAoB;IAEpB,KAAK,IAAI,IAAI,IAAI,KAAK,EAAE;QACtB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE;YACvB,MAAM,IAAI,UAAU,CAClB,MAAM,EACN,wDAAwD,IAAI,WAAW,CACxE,CAAC;SACH;KACF;IACD,OAAO,IAAI,CAAC;AACd,CAAC;AAED,MAAM,UAAU,gBAAgB,CAAC,MAAgB,EAAE,MAAoB;IACrE,IAAI,iBAAiB,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE;QACjC,OAAO,iBAAiB,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;KACtC;IAED,MAAM,EAAE,KAAK,EAAE,YAAY,EAAE,IAAI,EAAE,GAAG,MAAM,CAAC;IAE7C,MAAM,aAAa,GAAG,gBAAgB,CAAC,KAAK,CAAC,CAAC;IAE9C,IAAI,CAAC,qBAAqB,CAAC,MAAM,EAAE,aAAa,CAAC,EAAE;QACjD,OAAO;KACR;IAED,MAAM,YAAY,GAAG,YAAY;QAC/B,CAAC,CAAC,mBAAmB,CAAC,YAAY,CAAC;QACnC,CAAC,CAAC,kBAAkB,CAAC,aAAa,CAAC,CAAC;IAEtC,MAAM,QAAQ,GAAG,IAAI,gBAAgB,CAAC;QACpC,IAAI;QACJ,WAAW,EAAE,YAAY;QACzB,KAAK,EAAE,aAAoC;KAC5C,CAAC,CAAC;IAEH,iBAAiB,CAAC,GAAG,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;IACxC,OAAO,QAAQ,CAAC;AAClB,CAAC\"}","dts":{"name":"/Users/adampietrasiak/dev/oss/typegql/domains/union/compiler.d.ts","writeByteOrderMark":false,"text":"import { GraphQLUnionType, GraphQLResolveInfo } from 'graphql';\r\nimport { Thunk } from '~/services/types';\r\nexport interface UnionTypeResolver {\r\n    (value: any, context: any, info: GraphQLResolveInfo): any;\r\n}\r\nexport interface UnionOptions {\r\n    types: Thunk<any[]>;\r\n    name: string;\r\n    resolveTypes?: UnionTypeResolver;\r\n}\r\nexport declare function compileUnionType(target: Function, config: UnionOptions): GraphQLUnionType;\r\n"}}
